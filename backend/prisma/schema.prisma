generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Utilisateur {
  id                 String                   @id @default(uuid())
  email              String                   @unique
  motDePasse         String
  nom                String?
  prenom             String?
  role               Role                     @default(TRADUCTEUR)
  actif              Boolean                  @default(true)
  creeLe             DateTime                 @default(now())
  modifieLe          DateTime                 @updatedAt
  isPlayground       Boolean                  @default(false)
  playgroundNote     String?
  auditLogs          AuditLog[]
  divisionAccess     DivisionAccess[]
  equipeProjetAccess EquipeProjetAccess[]
  equipesConseiller  EquipeConseillerMembre[]
  sessions           Session[]
  traducteur         Traducteur?

  @@map("utilisateurs")
}

model JourFerie {
  id          String        @id @default(uuid())
  date        DateTime      @unique
  nom         String
  description String?
  type        TypeJourFerie @default(FEDERAL)
  actif       Boolean       @default(true)
  creeLe      DateTime      @default(now())
  modifieLe   DateTime      @updatedAt

  @@index([date])
  @@map("jours_feries")
}

model Session {
  id            String      @id @default(uuid())
  utilisateurId String
  token         String      @unique
  adresseIp     String?
  userAgent     String?
  actif         Boolean     @default(true)
  dernierAcces  DateTime    @default(now())
  expireA       DateTime
  creeLe        DateTime    @default(now())
  utilisateur   Utilisateur @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@index([utilisateurId])
  @@index([token])
  @@index([actif])
  @@map("sessions")
}

model AuditLog {
  id            String       @id @default(uuid())
  utilisateurId String?
  action        ActionAudit
  entite        String
  entiteId      String?
  details       Json?
  adresseIp     String?
  userAgent     String?
  succes        Boolean      @default(true)
  creeLe        DateTime     @default(now())
  utilisateur   Utilisateur? @relation(fields: [utilisateurId], references: [id])

  @@index([utilisateurId])
  @@index([action])
  @@index([entite])
  @@index([creeLe])
  @@map("audit_logs")
}

model Division {
  id                   String                 @id @default(uuid())
  nom                  String                 @unique
  code                 String                 @unique
  description          String?
  actif                Boolean                @default(true)
  creeLe               DateTime               @default(now())
  modifieLe            DateTime               @updatedAt
  acces                DivisionAccess[]
  traducteurDivisions  TraducteurDivision[]

  @@map("divisions")
}

model DivisionAccess {
  id            String      @id @default(uuid())
  utilisateurId String
  divisionId    String
  peutLire      Boolean     @default(true)
  peutEcrire    Boolean     @default(false)
  peutGerer     Boolean     @default(false)
  creeLe        DateTime    @default(now())
  modifieLe     DateTime    @updatedAt
  division      Division    @relation(fields: [divisionId], references: [id], onDelete: Cascade)
  utilisateur   Utilisateur @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@unique([utilisateurId, divisionId])
  @@index([utilisateurId])
  @@index([divisionId])
  @@map("division_access")
}

model EquipeProjetAccess {
  id             String       @id @default(uuid())
  utilisateurId  String
  equipeProjetId String
  peutLire       Boolean      @default(true)
  peutEcrire     Boolean      @default(false)
  peutGerer      Boolean      @default(false)
  creeLe         DateTime     @default(now())
  modifieLe      DateTime     @updatedAt
  equipeProjet   EquipeProjet @relation(fields: [equipeProjetId], references: [id], onDelete: Cascade)
  utilisateur    Utilisateur  @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@unique([utilisateurId, equipeProjetId])
  @@index([utilisateurId])
  @@index([equipeProjetId])
  @@map("equipe_projet_access")
}

model Traducteur {
  id                         String                       @id @default(uuid())
  nom                        String
  domaines                   String[]                     // DEPRECATED: utiliser traducteurDomaines
  clientsHabituels           String[]                     // DEPRECATED: utiliser traducteurClients
  capaciteHeuresParJour      Float                        @default(7.5)
  actif                      Boolean                      @default(true)
  utilisateurId              String                       @unique
  creeLe                     DateTime                     @default(now())
  modifieLe                  DateTime                     @updatedAt
  classification             String
  horaire                    String?
  heureDinerDebut            String?                      @default("12:00")
  heureDinerFin              String?                      @default("13:00")
  notes                      String?
  specialisations            String[]                     @default([]) // DEPRECATED: utiliser traducteurSpecialisations
  disponiblePourTravail      Boolean                      @default(false)
  disponibleDepuis           DateTime?                    // Date/heure où le traducteur s'est déclaré disponible
  commentaireDisponibilite   String?
  ciblageDisponibilite       Json?
  categorie                  CategorieTraducteur          @default(TR01)
  necessiteRevision          Boolean                      @default(true)
  divisions                  String[]                     @default([]) // DEPRECATED: utiliser traducteurDivisions
  ajustementsTemps           AjustementTemps[]
  equipesProjet              EquipeProjetMembre[]
  interetsDemandes           InteretDemande[]
  reviseursDe                LiaisonReviseur[]            @relation("TraducteurReviseur")
  revisePar                  LiaisonReviseur[]            @relation("TraducteurRevise")
  pairesLinguistiques        PaireLinguistique[]
  taches                     Tache[]
  traducteurClients          TraducteurClient[]
  traducteurDivisions        TraducteurDivision[]
  traducteurDomaines         TraducteurDomaine[]
  traducteurSpecialisations  TraducteurSpecialisation[]
  utilisateur                Utilisateur                  @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@index([actif])
  @@index([disponiblePourTravail])
  @@index([categorie])
  @@map("traducteurs")
}

model PaireLinguistique {
  id           String     @id @default(uuid())
  langueSource String
  langueCible  String
  traducteurId String
  creeLe       DateTime   @default(now())
  traducteur   Traducteur @relation(fields: [traducteurId], references: [id], onDelete: Cascade)
  taches       Tache[]

  @@unique([traducteurId, langueSource, langueCible])
  @@index([langueSource, langueCible])
  @@map("paires_linguistiques")
}

model Client {
  id                 String               @id @default(uuid())
  nom                String               @unique
  sousDomaines       String[]             // DEPRECATED
  actif              Boolean              @default(true)
  creeLe             DateTime             @default(now())
  modifieLe          DateTime             @updatedAt
  taches             Tache[]
  traducteurClients  TraducteurClient[]

  @@map("clients")
}

model SousDomaine {
  id            String   @id @default(uuid())
  nom           String   @unique
  domaineParent String?
  actif         Boolean  @default(true)
  creeLe        DateTime @default(now())
  modifieLe     DateTime @updatedAt
  domaineId     String?
  clientId      String?
  taches        Tache[]

  @@map("sous_domaines")
}

model Tache {
  id                        String             @id @default(uuid())
  numeroProjet              String             @default("N/A")
  description               String             @default("")
  specialisation            String             @default("")
  heuresTotal               Float
  compteMots                Int?
  dateEcheance              DateTime
  priorite                  String             @default("REGULIER")
  statut                    StatutTache        @default(PLANIFIEE)
  typeTache                 TypeTache          @default(TRADUCTION)
  modeDistribution          ModeDistribution   @default(JAT)
  traducteurId              String
  clientId                  String?
  sousDomaineId             String?
  paireLinguistiqueId       String?
  creePar                   String
  creeLe                    DateTime           @default(now())
  modifieLe                 DateTime           @updatedAt
  version                   Int                @default(0)
  modifiePar                String?
  commentaireCloture        String?
  dateDebutEffective        DateTime?
  dateFinEffective          DateTime?
  notificationRetardEnvoyee Boolean            @default(false)
  ajustementsTemps          AjustementTemps[]
  historique                HistoriqueTache[]
  notifications             Notification[]
  client                    Client?            @relation(fields: [clientId], references: [id])
  paireLinguistique         PaireLinguistique? @relation(fields: [paireLinguistiqueId], references: [id])
  sousDomaine               SousDomaine?       @relation(fields: [sousDomaineId], references: [id])
  traducteur                Traducteur         @relation(fields: [traducteurId], references: [id], onDelete: Cascade)

  @@index([traducteurId])
  @@index([dateEcheance])
  @@index([statut])
  @@index([priorite])
  @@map("taches")
}

model HistoriqueTache {
  id             String   @id @default(uuid())
  tacheId        String
  action         String
  champModifie   String?
  ancienneValeur String?
  nouvelleValeur String?
  utilisateurId  String
  utilisateur    String
  details        String?
  creeLe         DateTime @default(now())
  tache          Tache    @relation(fields: [tacheId], references: [id], onDelete: Cascade)

  @@index([tacheId])
  @@index([creeLe])
  @@map("historique_taches")
}

model Notification {
  id             String           @id @default(uuid())
  type           TypeNotification
  titre          String
  message        String
  lue            Boolean          @default(false)
  destinataireId String
  tacheId        String?
  donnees        String?
  creeLe         DateTime         @default(now())
  lueLe          DateTime?
  tache          Tache?           @relation(fields: [tacheId], references: [id], onDelete: Cascade)

  @@index([destinataireId, lue])
  @@index([destinataireId, creeLe])
  @@index([tacheId])
  @@map("notifications")
}

model AjustementTemps {
  id           String         @id @default(uuid())
  type         TypeAjustement
  traducteurId String
  tacheId      String?
  creePar      String
  creeLe       DateTime       @default(now())
  date         DateTime       @db.Date
  heures       Float
  heureDebut   String?
  heureFin     String?
  tache        Tache?         @relation(fields: [tacheId], references: [id], onDelete: Cascade)
  traducteur   Traducteur     @relation(fields: [traducteurId], references: [id], onDelete: Cascade)

  @@unique([traducteurId, date, tacheId, type])
  @@index([traducteurId, date])
  @@map("ajustements_temps")
}

model LiaisonReviseur {
  id           String      @id @default(uuid())
  traducteurId String
  reviseurId   String
  estPrincipal Boolean     @default(true)
  actif        Boolean     @default(true)
  notes        String?
  creeLe       DateTime    @default(now())
  modifieLe    DateTime    @updatedAt
  dateFin      DateTime?
  domaine      String?
  mode         ModeLiaison @default(ATTITRE)
  reviseur     Traducteur  @relation("TraducteurReviseur", fields: [reviseurId], references: [id], onDelete: Cascade)
  traducteur   Traducteur  @relation("TraducteurRevise", fields: [traducteurId], references: [id], onDelete: Cascade)

  @@unique([traducteurId, reviseurId])
  @@index([traducteurId])
  @@index([reviseurId])
  @@index([estPrincipal])
  @@map("liaisons_reviseur")
}

model DemandeRessource {
  id              String           @id @default(uuid())
  conseillerId    String
  titre           String
  description     String?
  heuresEstimees  Float?
  langueSource    String?
  langueCible     String?
  division        String?
  divisions       String[]         @default([])
  categories      String[]         @default([])
  specialisations String[]         @default([])
  domaines        String[]         @default([])
  equipeProjetId  String?
  urgence         Urgence          @default(NORMALE)
  actif           Boolean          @default(true)
  creeLe          DateTime         @default(now())
  modifieLe       DateTime         @updatedAt
  expireLe        DateTime?
  interets        InteretDemande[]

  @@index([conseillerId])
  @@index([actif])
  @@index([urgence])
  @@map("demandes_ressources")
}

model InteretDemande {
  id           String           @id @default(uuid())
  demandeId    String
  traducteurId String
  message      String?
  creeLe       DateTime         @default(now())
  demande      DemandeRessource @relation(fields: [demandeId], references: [id], onDelete: Cascade)
  traducteur   Traducteur       @relation(fields: [traducteurId], references: [id], onDelete: Cascade)

  @@unique([demandeId, traducteurId])
  @@index([demandeId])
  @@index([traducteurId])
  @@map("interets_demandes")
}

model EquipeProjet {
  id          String               @id @default(uuid())
  nom         String               @unique
  code        String               @unique
  description String?
  couleur     String               @default("#3B82F6")
  clientId    String?
  clientNom   String?
  objectif    String?
  dateDebut   DateTime?
  dateFin     DateTime?
  actif       Boolean              @default(true)
  archive     Boolean              @default(false)
  creePar     String
  creeLe      DateTime             @default(now())
  modifiePar  String?
  modifieLe   DateTime             @updatedAt
  acces       EquipeProjetAccess[]
  membres     EquipeProjetMembre[]

  @@index([actif])
  @@index([archive])
  @@index([clientId])
  @@map("equipes_projet")
}

model EquipeProjetMembre {
  id             String       @id @default(uuid())
  equipeProjetId String
  traducteurId   String
  role           RoleEquipe   @default(MEMBRE)
  dateAjout      DateTime     @default(now())
  dateRetrait    DateTime?
  actif          Boolean      @default(true)
  ajoutePar      String
  notes          String?
  equipeProjet   EquipeProjet @relation(fields: [equipeProjetId], references: [id], onDelete: Cascade)
  traducteur     Traducteur   @relation(fields: [traducteurId], references: [id], onDelete: Cascade)

  @@unique([equipeProjetId, traducteurId])
  @@index([equipeProjetId])
  @@index([traducteurId])
  @@index([actif])
  @@map("equipes_projet_membres")
}

model EquipeConseiller {
  id          String                   @id @default(uuid())
  nom         String                   @unique
  code        String                   @unique
  description String?
  couleur     String                   @default("#8B5CF6")
  actif       Boolean                  @default(true)
  creePar     String
  creeLe      DateTime                 @default(now())
  modifiePar  String?
  modifieLe   DateTime                 @updatedAt
  membres     EquipeConseillerMembre[]

  @@index([actif])
  @@map("equipes_conseiller")
}

model EquipeConseillerMembre {
  id                 String               @id @default(uuid())
  equipeConseillerId String
  utilisateurId      String
  role               RoleEquipeConseiller @default(MEMBRE)
  dateAjout          DateTime             @default(now())
  dateRetrait        DateTime?
  actif              Boolean              @default(true)
  ajoutePar          String
  notes              String?
  equipeConseiller   EquipeConseiller     @relation(fields: [equipeConseillerId], references: [id], onDelete: Cascade)
  utilisateur        Utilisateur          @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@unique([equipeConseillerId, utilisateurId])
  @@index([equipeConseillerId])
  @@index([utilisateurId])
  @@index([actif])
  @@map("equipes_conseiller_membres")
}

model Note {
  id                 String         @id @default(uuid())
  titre              String
  contenu            String
  categorie          CategorieNote  @default(GENERALE)
  visibilite         VisibiliteNote @default(EQUIPE)
  entiteType         TypeEntiteNote
  entiteId           String
  epingle            Boolean        @default(false)
  tags               String[]       @default([])
  ordre              Int            @default(0)
  creeParId          String
  creePar            String
  modifieParId       String?
  modifiePar         String?
  creeLe             DateTime       @default(now())
  modifieLe          DateTime       @updatedAt
  equipeConseillerId String?
  piecesJointes      PieceJointe[]

  @@index([entiteType, entiteId])
  @@index([creeParId])
  @@index([visibilite])
  @@index([epingle])
  @@index([categorie])
  @@index([equipeConseillerId])
  @@map("notes")
}

model PieceJointe {
  id          String          @id @default(uuid())
  nom         String
  nomOriginal String
  typeMime    String
  taille      Int
  chemin      String
  noteId      String?
  entiteType  TypeEntiteNote?
  entiteId    String?
  creeParId   String
  creePar     String
  creeLe      DateTime        @default(now())
  note        Note?           @relation(fields: [noteId], references: [id], onDelete: Cascade)

  @@index([noteId])
  @@index([entiteType, entiteId])
  @@map("pieces_jointes")
}

model Domaine {
  id                  String                @id @default(dbgenerated("(gen_random_uuid())::text"))
  nom                 String                @unique
  description         String?
  actif               Boolean               @default(true)
  creeLe              DateTime              @default(now())
  modifieLe           DateTime              @default(now())
  traducteurDomaines  TraducteurDomaine[]

  @@index([actif])
  @@map("domaines")
}

model Langue {
  id        String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  code      String   @unique
  nom       String   @unique
  actif     Boolean  @default(true)
  creeLe    DateTime @default(now())
  modifieLe DateTime @default(now())

  @@index([actif])
  @@map("langues")
}

model Specialisation {
  id                         String                       @id @default(dbgenerated("(gen_random_uuid())::text"))
  nom                        String                       @unique
  description                String?
  actif                      Boolean                      @default(true)
  creeLe                     DateTime                     @default(now())
  modifieLe                  DateTime                     @default(now())
  traducteurSpecialisations  TraducteurSpecialisation[]

  @@index([actif])
  @@map("specialisations")
}

model TraducteurClient {
  id           String     @id @default(dbgenerated("(gen_random_uuid())::text"))
  traducteurId String
  clientId     String
  creeLe       DateTime   @default(now())
  client       Client     @relation(fields: [clientId], references: [id], onDelete: Cascade)
  traducteur   Traducteur @relation(fields: [traducteurId], references: [id], onDelete: Cascade)

  @@unique([traducteurId, clientId])
  @@index([clientId])
  @@index([traducteurId])
  @@map("traducteur_clients")
}

model TraducteurDivision {
  id           String     @id @default(dbgenerated("(gen_random_uuid())::text"))
  traducteurId String
  divisionId   String
  creeLe       DateTime   @default(now())
  division     Division   @relation(fields: [divisionId], references: [id], onDelete: Cascade)
  traducteur   Traducteur @relation(fields: [traducteurId], references: [id], onDelete: Cascade)

  @@unique([traducteurId, divisionId])
  @@index([divisionId])
  @@index([traducteurId])
  @@map("traducteur_divisions")
}

model TraducteurDomaine {
  id           String     @id @default(dbgenerated("(gen_random_uuid())::text"))
  traducteurId String
  domaineId    String
  creeLe       DateTime   @default(now())
  domaine      Domaine    @relation(fields: [domaineId], references: [id], onDelete: Cascade)
  traducteur   Traducteur @relation(fields: [traducteurId], references: [id], onDelete: Cascade)

  @@unique([traducteurId, domaineId])
  @@index([domaineId])
  @@index([traducteurId])
  @@map("traducteur_domaines")
}

model TraducteurSpecialisation {
  id               String          @id @default(dbgenerated("(gen_random_uuid())::text"))
  traducteurId     String
  specialisationId String
  creeLe           DateTime        @default(now())
  specialisation   Specialisation  @relation(fields: [specialisationId], references: [id], onDelete: Cascade)
  traducteur       Traducteur      @relation(fields: [traducteurId], references: [id], onDelete: Cascade)

  @@unique([traducteurId, specialisationId])
  @@index([specialisationId])
  @@index([traducteurId])
  @@map("traducteur_specialisations")
}

enum TypeJourFerie {
  FEDERAL
  PROVINCIAL
  ORGANISATIONNEL
}

enum ActionAudit {
  CONNEXION
  DECONNEXION
  CONNEXION_ECHOUEE
  SESSION_EXPIREE
  SESSION_FORCEE
  UTILISATEUR_CREE
  UTILISATEUR_MODIFIE
  UTILISATEUR_SUPPRIME
  MOT_DE_PASSE_CHANGE
  ROLE_MODIFIE
  TACHE_CREEE
  TACHE_MODIFIEE
  TACHE_SUPPRIMEE
  STATUT_TACHE_CHANGE
  TACHE_ASSIGNEE
  TRADUCTEUR_CREE
  TRADUCTEUR_MODIFIE
  TRADUCTEUR_SUPPRIME
  CAPACITE_MODIFIEE
  JOUR_FERIE_CREE
  JOUR_FERIE_MODIFIE
  JOUR_FERIE_SUPPRIME
  REFERENTIEL_MODIFIE
  EXPORT_DONNEES
  IMPORT_DONNEES
}

enum TypeNotification {
  TACHE_EN_COURS
  TACHE_EN_RETARD
  TACHE_TERMINEE
  ESCALADE_GESTIONNAIRE
  RAPPEL_FERMETURE
}

enum Role {
  ADMIN
  CONSEILLER
  GESTIONNAIRE
  TRADUCTEUR
}

enum StatutTache {
  PLANIFIEE
  EN_COURS
  TERMINEE
  EN_RETARD
}

enum TypeTache {
  TRADUCTION
  REVISION
  RELECTURE
  ENCADREMENT
  AUTRE
}

enum TypeAjustement {
  TACHE
  BLOCAGE
}

enum ModeDistribution {
  JAT
  PEPS
  EQUILIBRE
  MANUEL
}

enum CategorieTraducteur {
  TR01
  TR02
  TR03
}

enum ModeLiaison {
  ATTITRE
  PONCTUEL
}

enum Urgence {
  FAIBLE
  NORMALE
  HAUTE
  CRITIQUE
}

enum RoleEquipe {
  RESPONSABLE
  MEMBRE
  REVISEUR
}

enum RoleEquipeConseiller {
  CHEF
  MEMBRE
}

enum TypeEntiteNote {
  CLIENT
  TRADUCTEUR
  DIVISION
  EQUIPE_PROJET
  TACHE
  SOUS_DOMAINE
  UTILISATEUR
  EQUIPE_CONSEILLER
}

enum CategorieNote {
  GENERALE
  CONTACT
  PROCEDURE
  TERMINOLOGIE
  PREFERENCE
  HISTORIQUE
  ALERTE
}

enum VisibiliteNote {
  PRIVE
  EQUIPE
  TRADUCTEUR
  PUBLIC
  EQUIPE_CONSEILLER
}
